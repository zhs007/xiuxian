# 计划：修仙主题卡牌游戏开发 (Plan 001)

## 1. 需求理解 (Requirement Analysis)

这是一个基于卡牌的策略游戏，背景为修仙世界。游戏的核心机制是事件驱动，玩家通过对事件卡做出选择来影响角色成长和游戏进程。

### 核心概念:
- **四种卡牌类型**: 角色卡, 行动卡, 道具卡, 事件卡。
- **角色系统**: 玩家和NPC都拥有角色，角色具有一个灵活、可扩展的属性系统 (map-like `string -> number`)。
- **事件驱动循环**: 游戏的主体流程是不断抽取“事件卡”，玩家二选一，根据选择和角色属性触发不同结果。
- **行动卡**: 触发特殊的游戏阶段，如战斗、炼丹、副本等。
- **道具卡**: 包含装备、消耗品、功法等，是角色的核心资产。
- **监听器系统 (Event Listener)**: 一个关键的底层系统，用于处理各种游戏内事件的联动效应（如装备自动护主、属性变化触发效果等）。
- **逻辑与渲染分离**: 架构上的核心要求，为未来迁移到客户端/服务器模式做准备。
- **存档系统**: 要求使用 JSON 格式，并希望能记录玩家的每一步操作，便于回溯和分析。
- **高测试覆盖率**: 逻辑部分要求 90% 以上的单元测试覆盖率。

## 2. 项目目标 (Project Goals)

1.  **构建一个稳固且可扩展的游戏核心框架**: 优先实现类型定义、事件系统、卡牌管理等基础模块。
2.  **实现核心玩法循环**: 完成从“选择角色”到“处理事件卡”再到“获得收益”的完整闭环。
3.  **确保代码质量**: 严格遵守 TypeScript 类型规范，编写高覆盖率的单元测试，产出清晰的开发文档。
4.  **实现视觉与交互**: 使用 Pixi.js 实现一个功能性的、符合手机竖屏操作习惯的 UI 界面。

## 3. 任务分解 (Task Breakdown)

1.  **创建项目文档**:
    *   `jules/plan001.md`: 本计划文件。
    *   `jules/plan001-report.md`: 开发过程报告。
    *   `jules.md`: 核心开发文档。
    *   `agents.md`: AI 代理开发规范。

2.  **项目基础架构搭建**:
    *   初始化项目，配置 TypeScript (`tsconfig.json`)。
    *   引入并配置构建工具（Vite）和测试框架（Vitest）。
    *   建立目录结构: `src/logic`, `src/rendering`, `src/types`, `src/assets`。

3.  **核心类型与数据模型定义 (`src/types/`)**:
    *   定义属性、卡牌、角色、道具、事件等所有核心概念的 TypeScript 接口。

4.  **核心逻辑系统开发与测试 (TDD)**:
    *   `EventListenerSystem`: 实现事件的派发与监听。
    *   `DeckManager`: 实现堆栈式卡池管理。
    *   `CharacterManager`: 管理角色及其属性。
    *   为以上系统编写单元测试。

5.  **游戏主循环逻辑实现**:
    *   实现游戏开始流程（新游戏/继续游戏）、角色选择。
    *   实现事件卡抽取与选择的核心循环。

6.  **渲染层 (Pixi.js) 开发**:
    *   搭建 Pixi.js 场景。
    *   实现卡牌、UI 元素的渲染。
    *   实现事件卡的拖拽交互。

7.  **存档与读档功能**:
    *   实现游戏状态的 JSON 序列化与反序列化。
    *   实现 UI 上的存档列表与加载功能。

8.  **功能完善与内容填充**:
    *   逐步实现各类行动卡和道具卡的具体逻辑。

9.  **最终审查与提交**:
    *   进行全面的功能测试和代码审查，并提交最终版本。
